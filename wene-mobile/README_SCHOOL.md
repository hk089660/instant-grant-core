# We-ne 参加券アプリ（学校向け）

イベント・行事に参加した記録を、QRコードを読み取るだけで簡単に残せるアプリです。

## 初回起動と登録

- **初回起動時**: アプリを開くと未登録の場合は自動で**アカウント登録画面**へ誘導されます。学年・表示名・確認用コードを入力して「登録する」をタップしてください。
- **登録後**: 登録情報は端末に保存され、アプリを閉じて再度開いても**ログイン状態が維持**されます。
- **未登録の参加**: 登録していない状態では参加処理は完了できません（参加者一覧の「参加する」やリンク参加時に登録を促すメッセージが表示されます）。

## 使い方

1. アプリを開く（初回は登録画面へ）
2. 「参加を開始」または「QRを読み取る」をタップ
3. 受付のQRコードを読み取る
4. イベント内容を確認して「参加する」をタップ
5. 「参加しました」「参加履歴に保存されました」と表示されたら完了

## 参加履歴

「参加券」画面で、未完了・完了済みの参加券を確認できます。

## 実運用（API 連携）

バックエンド API を用意している場合、環境変数で有効にできます。

- **EXPO_PUBLIC_SCHOOL_API_URL**: 学校向け API のベース URL（例: `https://api.example.com/school`）  
  **注意**: 管理者パスコードはサーバー側の環境変数（例: `SCHOOL_ADMIN_PASSCODE`）のみで設定し、`EXPO_PUBLIC_*` には含めないでください。
  - 設定すると以下が API 取得に切り替わります：
    - イベント一覧・作成・更新
    - カテゴリ一覧
    - 参加ログ（参加者検索・イベント別参加数）
    - 参加券の送信（利用者の「参加する」）
  - 未設定の場合は従来どおりローカルストア・永続化で動作します。
  - API 有効時、管理画面の「印刷用QR」はサーバー発行の参加用トークン（署名・有効期限付き）付き URL になり、`POST /school/claim` でトークン検証が行われます。本番運用では `SCHOOL_REQUIRE_JOIN_TOKEN=1` を推奨（詳細は `wene-mobile/server/README.md` および `wene-mobile/docs/SCHOOL_POC_LAN_SETUP.md`）。

API のエンドポイント例: `GET/POST /events`, `GET /categories`, `GET/POST /participations`, `POST /claim`, `POST /school/events/:id/join-token`

## 配布

- **Android**: APK を配布（Play Store 不要）
- **iOS**: TestFlight 経由で配布（予定）

## お問い合わせ

担当の先生・管理者にご相談ください。
