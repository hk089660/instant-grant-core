name = "instant-grant-core"
main = "src/index.ts"
compatibility_date = "2024-11-01"

[triggers]
crons = ["*/5 * * * *"]

[[durable_objects.bindings]]
name = "SCHOOL_STORE"
class_name = "SchoolStore"

[[migrations]]
tag = "v1"
new_sqlite_classes = ["SchoolStore"]

# Pages ドメインを CORS に指定する場合はここで変数化（デプロイ時はダッシュボードで設定推奨）
# [vars]
[vars]
CORS_ORIGIN = "https://instant-grant-core.pages.dev"
AUDIT_IMMUTABLE_MODE = "required"
AUDIT_IMMUTABLE_FETCH_TIMEOUT_MS = "5000"
AUDIT_RANDOM_ANCHOR_ENABLED = "true"
AUDIT_RANDOM_ANCHOR_PERIOD_MINUTES = "60"
SECURITY_RATE_LIMIT_ENABLED = "true"
SECURITY_RATE_LIMIT_READ_PER_MINUTE = "300"
SECURITY_RATE_LIMIT_MUTATION_PER_MINUTE = "120"
SECURITY_RATE_LIMIT_AUTH_PER_10_MINUTES = "60"
SECURITY_RATE_LIMIT_ADMIN_LOGIN_PER_10_MINUTES = "20"
SECURITY_RATE_LIMIT_VERIFY_PER_MINUTE = "120"
SECURITY_RATE_LIMIT_GLOBAL_PER_MINUTE = "2000"
SECURITY_RATE_LIMIT_BLOCK_SECONDS = "120"
SECURITY_MAX_REQUEST_BODY_BYTES = "65536"
SECURITY_ADMIN_EVENT_ISSUE_LIMIT_PER_DAY = "30"
SECURITY_ADMIN_INVITE_ISSUE_LIMIT_PER_DAY = "50"
COST_OF_FORGERY_ENABLED = "false"
COST_OF_FORGERY_FAIL_CLOSED = "true"
COST_OF_FORGERY_VERIFY_PATH = "/v1/risk/score"
COST_OF_FORGERY_TIMEOUT_MS = "2500"
COST_OF_FORGERY_MIN_SCORE = "70"
COST_OF_FORGERY_MIN_SCORE_SCHOOL_INTERNAL = "70"
COST_OF_FORGERY_MIN_SCORE_PUBLIC = "85"
COST_OF_FORGERY_ENFORCE_ON_REGISTER = "true"
COST_OF_FORGERY_ENFORCE_ON_CLAIM = "true"
COST_OF_FORGERY_FAIL_CLOSED_REGISTER = "false"
COST_OF_FORGERY_FAIL_CLOSED_CLAIM = "true"
COST_OF_FORGERY_CACHE_TTL_SECONDS = "300"
COST_OF_FORGERY_REMEDIATION_OVERRIDE_TTL_MINUTES = "1440"
# COST_OF_FORGERY_BASE_URL = "https://api.cost-of-forgery.example"
# COST_OF_FORGERY_API_KEY = "set-a-long-random-token"
# AUDIT_IMMUTABLE_INGEST_URL = "https://your-immutable-ingest.example/v1/audit"
# AUDIT_LOG_WRITE_TOKEN = "set-a-long-random-token"
# CORS_ORIGIN = "https://instant-grant-core.dev"

# NOTE:
# Configure these bindings with real resource IDs/names in Cloudflare dashboard
# (or uncomment and fill values here) before production deployment.
[[r2_buckets]]
binding = "AUDIT_LOGS"
bucket_name = "instant-grant-core-audit"
preview_bucket_name = "instant-grant-core-audit"

[[kv_namespaces]]
binding = "AUDIT_INDEX"
id = "2d73e1e5818447f8b965958831469901"
preview_id = "2d73e1e5818447f8b965958831469901"
